<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tropical 2048 - Fruit Evolution</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to bottom, #87CEEB 0%, #FFE4B5 100%);
            overflow: auto;
            padding: 10px;
        }

        #beach-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .game-container {
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 95vw;
            max-height: 95vh;
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            grid-template-rows: auto 1fr;
            gap: 15px;
            align-items: start;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: flex-start;
        }

        .center-panel {
            grid-column: 2;
            grid-row: 1 / 3;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: flex-start;
        }

        .palm-decoration {
            position: absolute;
            top: 20px;
            width: 60px;
            height: 80px;
            pointer-events: none;
        }

        .palm-decoration.left {
            left: 20px;
        }

        .palm-decoration.right {
            right: 20px;
        }

        h1 {
            color: #FF6B35;
            font-size: clamp(1.5em, 5vw, 2.5em);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 5px;
        }

        .subtitle {
            color: #2C5F2D;
            font-size: clamp(0.9em, 3vw, 1.2em);
            margin-bottom: 8px;
        }

        .score-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: flex-start;
        }

        .score-box {
            background: linear-gradient(135deg, #FFE4B5, #FFDAB9);
            padding: 10px 25px;
            border-radius: 10px;
            border: 3px solid #FF6B35;
        }

        .score-label {
            font-size: 0.9em;
            color: #2C5F2D;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .score-value {
            font-size: 1.8em;
            color: #FF6B35;
            font-weight: bold;
        }

        #game-board {
            background: #FFDAB9;
            border: 4px solid #FF6B35;
            border-radius: 15px;
            padding: 10px;
            display: inline-block;
            margin-bottom: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .grid {
            position: relative;
            width: min(530px, 80vw);
            height: min(530px, 80vw);
            max-width: 530px;
            max-height: 530px;
            background: transparent;
            margin: 0 auto;
        }

        .cell {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            border: 2px solid #D2B48C;
            width: 120px;
            height: 120px;
        }

        .tile {
            position: absolute;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 8px;
            border: 3px solid #8B4513;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease-in-out;
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.3);
            width: 120px;
            height: 120px;
        }

        .tile.new {
            animation: appear 0.2s ease-in-out;
        }

        .tile.merged {
            animation: merge 0.3s ease-in-out;
        }

        @keyframes appear {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes merge {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .tile-emoji {
            font-size: 3.5em;
            margin-bottom: 5px;
        }

        .tile-value {
            font-size: 1.1em;
            color: #2C5F2D;
            font-weight: bold;
        }

        .controls {
            background: #FFE4B5;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.85em;
            color: #2C5F2D;
            text-align: center;
            border: 3px solid #FF6B35;
        }

        .controls strong {
            color: #FF6B35;
        }

        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        button {
            background: #FF6B35;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        button:hover {
            background: #FF8555;
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.95);
        }

        .sun {
            position: absolute;
            top: 50px;
            right: 100px;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border-radius: 50%;
            box-shadow: 0 0 50px #FFD700;
            animation: pulse 3s ease-in-out infinite;
            z-index: 5;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        #game-over-screen {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 107, 53, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 100;
            border: 5px solid white;
        }

        #game-over-screen h2 {
            color: white;
            font-size: 3em;
            margin-bottom: 20px;
        }

        #game-over-screen .message {
            color: white;
            font-size: 1.5em;
            margin: 15px 0;
        }

        #game-over-screen button {
            background: white;
            color: #FF6B35;
            padding: 15px 40px;
            font-size: 1.3em;
            margin-top: 10px;
        }

        .fruit-guide {
            background: linear-gradient(135deg, #98D8C8, #6BCF7F);
            padding: 10px;
            border-radius: 10px;
            border: 3px solid #2C5F2D;
            text-align: left;
        }

        .fruit-guide h3 {
            color: #2C5F2D;
            margin-bottom: 8px;
            font-size: 1em;
            text-align: center;
        }

        .fruit-progression {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 0.85em;
            color: #2C5F2D;
        }

        .fruit-item {
            background: rgba(255, 255, 255, 0.7);
            padding: 5px 8px;
            border-radius: 5px;
            text-align: left;
        }

        @media (max-width: 1000px) {
            .game-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 10px;
            }

            .left-panel {
                grid-column: 1;
                grid-row: 1;
            }

            .center-panel {
                grid-column: 1;
                grid-row: 2;
            }

            .right-panel {
                grid-column: 1;
                grid-row: 3;
            }

            .score-container {
                flex-direction: row;
                justify-content: center;
            }

            .fruit-progression {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        @media (max-width: 600px) or (max-height: 800px) {
            .grid {
                transform: scale(0.7);
                transform-origin: center;
            }

            .game-container {
                padding: 10px;
            }

            .score-box {
                padding: 8px 15px;
            }

            .fruit-guide {
                padding: 8px;
            }
        }

        @media (max-width: 400px) or (max-height: 650px) {
            .grid {
                transform: scale(0.5);
            }
        }
    </style>
</head>
<body>
    <canvas id="beach-background"></canvas>
    <div class="sun"></div>

    <div class="game-container">
        <canvas class="palm-decoration left" width="60" height="80"></canvas>
        <canvas class="palm-decoration right" width="60" height="80"></canvas>

        <!-- Left Panel: Fruit Guide & Controls -->
        <div class="left-panel">
            <div class="fruit-guide">
                <h3>üå∫ Fruit Evolution üå∫</h3>
                <div class="fruit-progression">
                    <div class="fruit-item">üçá2</div>
                    <div class="fruit-item">üçã4</div>
                    <div class="fruit-item">üçä8</div>
                    <div class="fruit-item">üçé16</div>
                    <div class="fruit-item">ü••32</div>
                    <div class="fruit-item">üçç64</div>
                    <div class="fruit-item">ü•ë128</div>
                    <div class="fruit-item">üçâ256</div>
                    <div class="fruit-item">ü•≠512</div>
                    <div class="fruit-item">üçà1024</div>
                    <div class="fruit-item">üèÜ2048</div>
                </div>
            </div>

            <div class="controls">
                Use <strong>Arrow Keys</strong> to slide and merge fruits!
            </div>
        </div>

        <!-- Center Panel: Game Board -->
        <div class="center-panel">
            <h1>üå¥ Tropical 2048 üå¥</h1>
            <div class="subtitle">Merge fruits to evolve them!</div>

            <div id="game-board">
                <div class="grid">
                    <div class="cell" style="left: 10px; top: 10px;"></div>
                    <div class="cell" style="left: 140px; top: 10px;"></div>
                    <div class="cell" style="left: 270px; top: 10px;"></div>
                    <div class="cell" style="left: 400px; top: 10px;"></div>
                    <div class="cell" style="left: 10px; top: 140px;"></div>
                    <div class="cell" style="left: 140px; top: 140px;"></div>
                    <div class="cell" style="left: 270px; top: 140px;"></div>
                    <div class="cell" style="left: 400px; top: 140px;"></div>
                    <div class="cell" style="left: 10px; top: 270px;"></div>
                    <div class="cell" style="left: 140px; top: 270px;"></div>
                    <div class="cell" style="left: 270px; top: 270px;"></div>
                    <div class="cell" style="left: 400px; top: 270px;"></div>
                    <div class="cell" style="left: 10px; top: 400px;"></div>
                    <div class="cell" style="left: 140px; top: 400px;"></div>
                    <div class="cell" style="left: 270px; top: 400px;"></div>
                    <div class="cell" style="left: 400px; top: 400px;"></div>
                    <div id="tiles-container"></div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Scores -->
        <div class="right-panel">
            <div class="score-container">
                <div class="score-box">
                    <div class="score-label">SCORE</div>
                    <div class="score-value" id="score">0</div>
                </div>
                <div class="score-box">
                    <div class="score-label">BEST</div>
                    <div class="score-value" id="best">0</div>
                </div>
            </div>

            <div class="button-container">
                <button onclick="newGame()">üéÆ New Game</button>
            </div>
        </div>
    </div>

    <div id="game-over-screen">
        <h2 id="game-over-title">Game Over!</h2>
        <div class="message">Final Score: <span id="final-score">0</span></div>
        <div class="message">Best Score: <span id="final-best">0</span></div>
        <button onclick="newGame()">Play Again</button>
    </div>

    <script>
        // Beach background
        const bgCanvas = document.getElementById('beach-background');
        const bgCtx = bgCanvas.getContext('2d');
        bgCanvas.width = window.innerWidth;
        bgCanvas.height = window.innerHeight;

        let waves = [];
        for (let i = 0; i < 5; i++) {
            waves.push({
                y: bgCanvas.height - 200 + i * 15,
                amplitude: 10 + i * 3,
                frequency: 0.01 - i * 0.001,
                speed: 0.5 + i * 0.2,
                offset: Math.random() * 100
            });
        }

        function drawBeach(time) {
            const gradient = bgCtx.createLinearGradient(0, 0, 0, bgCanvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(0.7, '#FFE4B5');
            bgCtx.fillStyle = gradient;
            bgCtx.fillRect(0, 0, bgCanvas.width, bgCanvas.height);

            waves.forEach((wave, index) => {
                bgCtx.beginPath();
                bgCtx.moveTo(0, bgCanvas.height);
                for (let x = 0; x <= bgCanvas.width; x++) {
                    const y = wave.y + Math.sin(x * wave.frequency + wave.offset + time * wave.speed * 0.001) * wave.amplitude;
                    bgCtx.lineTo(x, y);
                }
                bgCtx.lineTo(bgCanvas.width, bgCanvas.height);
                bgCtx.closePath();
                const alpha = 0.3 - index * 0.05;
                bgCtx.fillStyle = `rgba(64, 224, 208, ${alpha})`;
                bgCtx.fill();
            });

            bgCtx.fillStyle = '#F4A460';
            bgCtx.fillRect(0, bgCanvas.height - 150, bgCanvas.width, 150);
        }

        // Draw palm tree decorations next to title
        function drawPalmDecoration(canvas) {
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;

            // Trunk
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(centerX - 4, 20, 8, 50);

            // Leaves
            ctx.fillStyle = '#228B22';
            for (let i = 0; i < 6; i++) {
                const angle = (i * 60) * Math.PI / 180;
                ctx.beginPath();
                ctx.ellipse(
                    centerX + Math.cos(angle) * 20,
                    20 + Math.sin(angle) * 20,
                    25, 8, angle, 0, Math.PI * 2
                );
                ctx.fill();
            }
        }

        // Draw decorative palm trees
        const leftPalm = document.querySelector('.palm-decoration.left');
        const rightPalm = document.querySelector('.palm-decoration.right');
        drawPalmDecoration(leftPalm);
        drawPalmDecoration(rightPalm);

        function animateBeach(time = 0) {
            drawBeach(time);
            requestAnimationFrame(animateBeach);
        }
        animateBeach();

        // Fruit mapping
        const FRUITS = {
            2: { emoji: 'üçá', name: 'Grape', color: '#9B59B6' },
            4: { emoji: 'üçã', name: 'Lemon', color: '#F7DC6F' },
            8: { emoji: 'üçä', name: 'Orange', color: '#FFA500' },
            16: { emoji: 'üçé', name: 'Apple', color: '#FF6B6B' },
            32: { emoji: 'ü••', name: 'Coconut', color: '#8B4513' },
            64: { emoji: 'üçç', name: 'Pineapple', color: '#FFD700' },
            128: { emoji: 'ü•ë', name: 'Avocado', color: '#6BCF7F' },
            256: { emoji: 'üçâ', name: 'Watermelon', color: '#FF6B6B' },
            512: { emoji: 'ü•≠', name: 'Mango', color: '#FFB347' },
            1024: { emoji: 'üçà', name: 'Melon', color: '#98D8C8' },
            2048: { emoji: 'üèÜ', name: 'Trophy', color: '#FFD700' }
        };

        // Game state
        let grid = [];
        let score = 0;
        let bestScore = localStorage.getItem('tropical2048Best') || 0;
        let gameOver = false;
        let won = false;
        let tilesContainer = document.getElementById('tiles-container');

        document.getElementById('best').textContent = bestScore;

        // Initialize grid
        function initGrid() {
            grid = [];
            for (let i = 0; i < 4; i++) {
                grid[i] = [];
                for (let j = 0; j < 4; j++) {
                    grid[i][j] = 0;
                }
            }
        }

        // Add random tile
        function addRandomTile() {
            const emptyCells = [];
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (grid[i][j] === 0) {
                        emptyCells.push({ row: i, col: j });
                    }
                }
            }

            if (emptyCells.length > 0) {
                const { row, col } = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                grid[row][col] = Math.random() < 0.9 ? 2 : 4;
                return true;
            }
            return false;
        }

        // Render grid
        function render() {
            tilesContainer.innerHTML = '';

            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (grid[i][j] !== 0) {
                        const value = grid[i][j];
                        const fruit = FRUITS[value];

                        const tile = document.createElement('div');
                        tile.className = 'tile';
                        // Use absolute positioning with pixels
                        tile.style.left = (j * 130 + 10) + 'px';
                        tile.style.top = (i * 130 + 10) + 'px';
                        tile.style.borderColor = fruit.color;

                        tile.innerHTML = `
                            <div class="tile-emoji">${fruit.emoji}</div>
                            <div class="tile-value">${value}</div>
                        `;

                        tilesContainer.appendChild(tile);
                    }
                }
            }

            document.getElementById('score').textContent = score;
        }

        // Move tiles
        function move(direction) {
            if (gameOver) return;

            let moved = false;
            const oldGrid = JSON.parse(JSON.stringify(grid));

            if (direction === 'left') {
                for (let i = 0; i < 4; i++) {
                    const row = grid[i].filter(val => val !== 0);
                    const merged = [];

                    for (let j = 0; j < row.length; j++) {
                        if (j < row.length - 1 && row[j] === row[j + 1]) {
                            merged.push(row[j] * 2);
                            score += row[j] * 2;
                            if (row[j] * 2 === 2048 && !won) {
                                won = true;
                                setTimeout(() => showWin(), 500);
                            }
                            j++;
                        } else {
                            merged.push(row[j]);
                        }
                    }

                    while (merged.length < 4) merged.push(0);
                    grid[i] = merged;
                }
            } else if (direction === 'right') {
                for (let i = 0; i < 4; i++) {
                    const row = grid[i].filter(val => val !== 0).reverse();
                    const merged = [];

                    for (let j = 0; j < row.length; j++) {
                        if (j < row.length - 1 && row[j] === row[j + 1]) {
                            merged.push(row[j] * 2);
                            score += row[j] * 2;
                            if (row[j] * 2 === 2048 && !won) {
                                won = true;
                                setTimeout(() => showWin(), 500);
                            }
                            j++;
                        } else {
                            merged.push(row[j]);
                        }
                    }

                    while (merged.length < 4) merged.push(0);
                    grid[i] = merged.reverse();
                }
            } else if (direction === 'up') {
                for (let j = 0; j < 4; j++) {
                    const col = [];
                    for (let i = 0; i < 4; i++) {
                        if (grid[i][j] !== 0) col.push(grid[i][j]);
                    }

                    const merged = [];
                    for (let i = 0; i < col.length; i++) {
                        if (i < col.length - 1 && col[i] === col[i + 1]) {
                            merged.push(col[i] * 2);
                            score += col[i] * 2;
                            if (col[i] * 2 === 2048 && !won) {
                                won = true;
                                setTimeout(() => showWin(), 500);
                            }
                            i++;
                        } else {
                            merged.push(col[i]);
                        }
                    }

                    while (merged.length < 4) merged.push(0);
                    for (let i = 0; i < 4; i++) {
                        grid[i][j] = merged[i];
                    }
                }
            } else if (direction === 'down') {
                for (let j = 0; j < 4; j++) {
                    const col = [];
                    for (let i = 3; i >= 0; i--) {
                        if (grid[i][j] !== 0) col.push(grid[i][j]);
                    }

                    const merged = [];
                    for (let i = 0; i < col.length; i++) {
                        if (i < col.length - 1 && col[i] === col[i + 1]) {
                            merged.push(col[i] * 2);
                            score += col[i] * 2;
                            if (col[i] * 2 === 2048 && !won) {
                                won = true;
                                setTimeout(() => showWin(), 500);
                            }
                            i++;
                        } else {
                            merged.push(col[i]);
                        }
                    }

                    while (merged.length < 4) merged.push(0);
                    for (let i = 0; i < 4; i++) {
                        grid[3 - i][j] = merged[i];
                    }
                }
            }

            // Check if grid changed
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (grid[i][j] !== oldGrid[i][j]) {
                        moved = true;
                    }
                }
            }

            if (moved) {
                addRandomTile();
                render();

                if (score > bestScore) {
                    bestScore = score;
                    localStorage.setItem('tropical2048Best', bestScore);
                    document.getElementById('best').textContent = bestScore;
                }

                if (!canMove()) {
                    gameOver = true;
                    setTimeout(() => showGameOver(), 500);
                }
            }
        }

        // Check if any move is possible
        function canMove() {
            // Check for empty cells
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    if (grid[i][j] === 0) return true;
                }
            }

            // Check for possible merges
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    const current = grid[i][j];
                    if (j < 3 && grid[i][j + 1] === current) return true;
                    if (i < 3 && grid[i + 1][j] === current) return true;
                }
            }

            return false;
        }

        // Show win screen
        function showWin() {
            document.getElementById('game-over-title').textContent = 'You Win! üèÜ';
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-best').textContent = bestScore;
            document.getElementById('game-over-screen').style.display = 'block';
        }

        // Show game over screen
        function showGameOver() {
            document.getElementById('game-over-title').textContent = 'Game Over!';
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-best').textContent = bestScore;
            document.getElementById('game-over-screen').style.display = 'block';
        }

        // New game
        function newGame() {
            document.getElementById('game-over-screen').style.display = 'none';
            initGrid();
            score = 0;
            gameOver = false;
            won = false;
            addRandomTile();
            addRandomTile();
            render();
        }

        // Keyboard controls
        document.addEventListener('keydown', e => {
            if (gameOver && e.key !== 'Enter') return;

            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    move('left');
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    move('right');
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    move('up');
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    move('down');
                    break;
            }
        });

        // Start game
        newGame();
    </script>
</body>
</html>
